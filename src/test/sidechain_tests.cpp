// Copyright (c) 2017 The Bitcoin Core developers
// Distributed under the MIT software license, see the accompanying
// file COPYING or http://www.opensource.org/licenses/mit-license.php.

#include "bmmcache.h"
#include "chainparams.h"
#include "consensus/validation.h"
#include "core_io.h"
#include "miner.h"
#include "policy/policy.h"
#include "random.h"
#include "script/sigcache.h"
#include "sidechain.h"
#include "uint256.h"
#include "util.h"
#include "utilstrencodings.h"
#include "validation.h"

#include "test/test_bitcoin.h"

#include <boost/test/unit_test.hpp>

static CFeeRate blockMinFeeRate = CFeeRate(DEFAULT_BLOCK_MIN_TX_FEE);

static BlockAssembler AssemblerForTest(const CChainParams& params) {
    BlockAssembler::Options options;

    options.nBlockMaxWeight = MAX_BLOCK_WEIGHT;
    options.blockMinFeeRate = blockMinFeeRate;
    return BlockAssembler(params, options);
}

BOOST_FIXTURE_TEST_SUITE(sidechain_tests, TestChain100Setup)


BOOST_AUTO_TEST_CASE(sidechain_bmm_valid_not_verified)
{
    // Test CheckBlock a block with valid BMM when -verifybmmcheckblock = false
    const CChainParams chainparams = Params();

    BOOST_CHECK(chainActive.Height() == COINBASE_MATURITY);

    // Set -verifybmmcheckblock arg to false
    gArgs.ForceSetArg("-verifybmmcheckblock", "0");
    gArgs.ForceSetArg("-verifybmmacceptblock", "0");

    // Generate BMM block
    CScript scriptPubKey;
    CBlock block;
    std::string strError = "";
    BOOST_CHECK(AssemblerForTest(Params()).GenerateBMMBlock(scriptPubKey, block, strError));

    std::shared_ptr<const CBlock> shared_pblock = std::make_shared<const CBlock>(block);
    BOOST_CHECK(ProcessNewBlock(chainparams, shared_pblock, true, nullptr));

    BOOST_CHECK(chainActive.Height() == COINBASE_MATURITY + 1);
}

BOOST_AUTO_TEST_CASE(sidechain_bmm_valid)
{
    // A real example of a BMM (blinded) block before BMM proof has been added
    std::string blockHex = "00000020b1e9cedbf0f6ee194d88a795fe7d0a53b9c0355921b2155ef16757de27388130814b76a3d8af13bbb73118eadb735b09f6f8190683f4f221ebdb75edb6bdfd3df0a12b5dffff7f200100000000030000003f000000000000000000000000000000000000000000000000000000000000000000000000000001030000003f0001010000000000000000000000000000000000000000000000000000000000000000ffffffff03520101ffffffff020000000000000000000000000000000000266a24aa21a9ede2f61c3f71d1defd3fa999dfa36953755c690689799962b48bebd836974e8cf90120000000000000000000000000000000000000000000000000000000000000000000000000";

    // A real example of a mainchain coinbase BMM h* commitment
    std::string coinbaseHex = "020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff0502f3000101ffffffff03cc02062a01000000232102cda85899a9c51865e2482db94287f783ded2c77bb70ba327f3d51db67b318f59ac0000000000000000346a24d16173687f5fbe3f1cd68618c06e3236e3c73ee9081c56d0e185a8ea411343529f8ae55700bf0000000833323334363536330000000000000000266a24aa21a9ed607fb8779d041f21a8bb6292f63d82c6b2b4f7c470cc5481f3b371779a6384f50120000000000000000000000000000000000000000000000000000000000000000000000000";

    // A real example of the partial merkle tree proof used for BMM proof
    std::string proofHex = "00000020ec24cb98378b55fd9a570beb8a8d1b347388d29a29aba43b594a4c3cb1d5c18fd9030dbeee976380722d48f2c62b950580a0612060cf21800a84a5b2e37b63a925a22b5dffff5f1dab2c700002000000027beb77071246b2c3dd64ac5e755a35711700c0340faa1cd08a0b08824ae08285329fb8a709c787029e92d0cd12391380f3ad2935818123151c4607fd29ea195b0103";

    // Deserialize the example block
    CDataStream ss(ParseHex(blockHex), SER_DISK, PROTOCOL_VERSION);
    CBlock block;
    block.Unserialize(ss);

    // Should fail here, no BMM proof in block
    BOOST_CHECK(!VerifyCriticalHashProof(block));

    // Add BMM proof to the blck
    BOOST_CHECK(DecodeHexTx(block.criticalTx, coinbaseHex));
    block.criticalProof = proofHex;

    // Should fail here again, as we have no connection to the mainchain and
    // haven't cached the validation of this BMM proof
    BOOST_CHECK(!VerifyCriticalHashProof(block));

    // Cache the validation of this BMM proof
    bmmCache.CacheBMMProof(block.GetHash(), block.criticalTx.GetHash());
    BOOST_CHECK(bmmCache.HaveBMMProof(block.GetHash(), block.criticalTx.GetHash()));

    // It should pass now that we have added the BMM proof to the block and
    // cached the validation of that BMM proof.
    BOOST_CHECK(VerifyCriticalHashProof(block));
}

BOOST_AUTO_TEST_CASE(sidechain_bmm_invalid_verified)
{
    // Test CheckBlock without valid BMM when -verifybmmcheckblock = true
    const CChainParams chainparams = Params();

    BOOST_CHECK(chainActive.Height() == COINBASE_MATURITY);

    // Set -verifybmmcheckblock arg to true
    gArgs.ForceSetArg("-verifybmmcheckblock", "1");

    // Generate BMM block
    CScript scriptPubKey;
    CBlock block;
    std::string strError = "";
    BOOST_CHECK(AssemblerForTest(Params()).GenerateBMMBlock(scriptPubKey, block, strError));

    std::shared_ptr<const CBlock> shared_pblock = std::make_shared<const CBlock>(block);
    BOOST_CHECK(!ProcessNewBlock(chainparams, shared_pblock, true, nullptr));

    BOOST_CHECK(chainActive.Height() == COINBASE_MATURITY);

    // Set -verifybmmcheckblock arg back to default (gArgs effect all tests)
    gArgs.ForceSetArg("-verifybmmcheckblock", "0");
}

// TODO although more complicated than it may seem at first, it would be nice
// if we could also have a valid test that uses the TestChain100 and extends
// that chain. For now we can call VerifyCriticalHashProof on the block.

BOOST_AUTO_TEST_CASE(sidechain_bmm_cache)
{
    uint256 hashRand = GetRandHash();

    // Reject null block hash
    bmmCache.CacheBMMProof(uint256(), hashRand);
    BOOST_CHECK(!bmmCache.HaveBMMProof(uint256(), hashRand));

    // Reject null critical tx hash
    bmmCache.CacheBMMProof(hashRand, uint256());
    BOOST_CHECK(!bmmCache.HaveBMMProof(hashRand, uint256()));

    // Accept valid
    uint256 hash1 = GetRandHash();
    uint256 hash2 = GetRandHash();
    bmmCache.CacheBMMProof(hash1, hash2);
    BOOST_CHECK(bmmCache.HaveBMMProof(hash1, hash2));

    // Reject another
    bmmCache.CacheBMMProof(uint256(), hash1);
    BOOST_CHECK(!bmmCache.HaveBMMProof(uint256(), hashRand));

    // Accept many & check that they have been cached
    for (int i = 0; i <= 1776; i++) {
        uint256 hashRand1 = GetRandHash();
        uint256 hashRand2 = GetRandHash();
        bmmCache.CacheBMMProof(hashRand1, hashRand2);
        BOOST_CHECK(bmmCache.HaveBMMProof(hashRand1, hashRand2));
    }

    // Check that the first cached item still can be looked up
    BOOST_CHECK(bmmCache.HaveBMMProof(hash1, hash2));
}


// TODO :
// sidechain_wt
// sidechain_wt^
// sidechain deposit proof
// sidechain wt reuse in WT^
// sidechain deposit reuse
// sidechain deposit maturity

// TODO finish
BOOST_AUTO_TEST_CASE(sidechain_deposit)
{
    BOOST_CHECK(!psidechaintree->HaveDeposits());

    const CChainParams chainparams = Params();

    BOOST_CHECK(chainActive.Height() == COINBASE_MATURITY);
/*
    // Generate BMM block
    CScript scriptPubKey;
    CBlock block;
    std::string strError = "";
    BOOST_CHECK(AssemblerForTest(Params()).GenerateBMMBlock(scriptPubKey, block, strError));


    std::shared_ptr<const CBlock> shared_pblock = std::make_shared<const CBlock>(block);
    BOOST_CHECK(ProcessNewBlock(chainparams, shared_pblock, true, nullptr));

    BOOST_CHECK(chainActive.Height() == 101);
*/
}

std::vector<SidechainDeposit> Get10TestDeposits()
{
    // Serialization of 10 real sidechain deposits, in valid CTIP spend order.
    // None of these deposits spend the same transaction.

    std::string strD1 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a456400e1f5050000000002000000016d70702fdebcf2080140c5ddfde406934ebcb0c96bcdcdfafd94d26f96a7ed440000000049483045022100d219d513ba208cf97f9ea1550ab1959d042e63f58f3694ead1d7a65a88e396980220533dc9fb34b2c6f7fa96755bd9bddfdb375c9b497d4705d2901d0418edc7121f01ffffffff038081748e000000001976a9141a0aa7d7fe4413d920d0b9ce7a7cb9f21bbbc72f88ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a456400e1f505000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d000000058f45e5629e5082a257f5ec955e19361450d225bd827e6c50382ef8b5f1719ce18845a607ba22bc4f0eac21ce286dc94d72a1e1216e11b077b53b625209c4ee64a959b97a91f65d623512e06922782e932f2be02c7f8ca3bd57d7c37d99f00b82d318c204c9ce65eefa1b7ea4f4de8c77acff435c93565f8192b29c9ae56c5b10d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef47022f0002000000";

    std::string strD2 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a456400a3e1110000000002000000022a04bb21e0c1ef4fcda5ff5a63b765eaa1dc942c53ba820178d6645395ef21c20000000049483045022100cf04c8120dc3885586dff6b26cc65998203c77deb5b611470d8506e41c6db61a022036aeb6f4feb623bf9ac49fb7880723393bcaaf593522aaff1a1fa7985d1e60f501ffffffff8845a607ba22bc4f0eac21ce286dc94d72a1e1216e11b077b53b625209c4ee64020000008a4730440220459fdc5b0a4d3e64d0085506ff217fc6a023324301b12e5901e7d99c3fd78ffd02201dd58814fe69d2b0ae00c4bf335b7b861b4edabb4f35d41be1d6cd9dd0ae3ef10141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380a07e88000000001976a9140ef6c727dc7eb60915977b3fae5a44437247d63188ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a456400a3e111000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d00000005a9072dc307cd931eb0a1e9a97f064f8a31c979fbdedcf2c0465a7d696460a1c70315c4cc89975460763ff9ffae1f0eebb2a57a689b702bf910c6181108ab2013c91418169b7a6ab17d700f1827b378d172fef69d68c73c634f798b071d8a07bdd318c204c9ce65eefa1b7ea4f4de8c77acff435c93565f8192b29c9ae56c5b10d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef4702370002000000";

    std::string strD3 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a45640046c323000000000200000002f66e6d6a5f846508e9794c1344991368a4f4e8d0a7395cf4af1322d4a9246c3900000000484730440220140106850106ae13b39294b74b2670fdf6f150b81b6471aa5a4a29dd2afeee04022015c0124b929ea975af62210240caa248e950c069584a2176157e81a9045d71b701ffffffff0315c4cc89975460763ff9ffae1f0eebb2a57a689b702bf910c6181108ab2013020000008b4830450221008bde699530f2338b17a1bb36f811e1779c51705dfc7353e9f9fee04f86fa7fca022064fe7664ab126c92bf395f47853f449498363c4fa84ac9113b56badfcee18e0e0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380bf8882000000001976a91481b679f57105062cdccf229587b75cedf850843888ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a45640046c323000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d00000005a9072dc307cd931eb0a1e9a97f064f8a31c979fbdedcf2c0465a7d696460a1c70315c4cc89975460763ff9ffae1f0eebb2a57a689b702bf910c6181108ab2013c91418169b7a6ab17d700f1827b378d172fef69d68c73c634f798b071d8a07bdd318c204c9ce65eefa1b7ea4f4de8c77acff435c93565f8192b29c9ae56c5b10d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef4702570002000000";

    std::string strD4 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a456400ca9a3b000000000200000002003e8b7294098f247f69931e54f9f5e3155bfcf8e5b3e1bf24fce79c1b1520790000000048473044022017fce77620fc2c2931d0561428d8ff789642b696bb0ea5dfd9c59b0c6e8ce45e0220251590e388c631173c1aee4427c78c8a45aec2a9a2c54b29bc1194af14a93f8401ffffffffc91418169b7a6ab17d700f1827b378d172fef69d68c73c634f798b071d8a07bd020000008a4730440220429cc9b0ba19f92d70764fe1d3a3c6d8736a985d9dd075bf29fe7c4dfc7e323c02202685379f1758cd6ff15e73e37812f69e87b5a4417d3b64a723d09d00e84007ad0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380de927c000000001976a9149f684e5c3a6101c7b3037dade15a187605627e8c88ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a456400ca9a3b000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d000000054dd75341f054b52e0ce3500888e66d80f413a4c219311a59ef3ae821b716834ae18c5d64db4b1446f3f45b2d75b97373689bca0aa2da038aa1d48d581c460963013d9eacc3ff502412ac4d0e6618921f28d9efaad044afc581f0af29deed138fff89c693abfcd162fa6a870a457775387bda8e5a63545b27e6aa5a52950b65c4d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef47023b0002000000";

    std::string strD5 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a4564002f68590000000002000000020d295e6c9890014a1472cbb427a06b9180c3e7371ea17047582c43e00876425e0000000049483045022100d1d263a9f6359d471913e625e732e2dfd13008f7ba237e128816f8f06d7e8858022002a7fb929e57d6e018278deaa13695cbc740786d2115266b759f42bfd33f2c0b01ffffffffe18c5d64db4b1446f3f45b2d75b97373689bca0aa2da038aa1d48d581c460963020000008b483045022100971e5bdbbb635981c0283c3952df63d6e8e648a90ef6bbc66f37d3317c553423022025f9730a067e2b03b81f66d9712814832da7e1e15a9511810fc14832f792d7f00141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380fd9c76000000001976a91437bb0f295a438030a978e63514f3e19032797e9088ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a4564002f6859000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d000000054dd75341f054b52e0ce3500888e66d80f413a4c219311a59ef3ae821b716834ae18c5d64db4b1446f3f45b2d75b97373689bca0aa2da038aa1d48d581c460963013d9eacc3ff502412ac4d0e6618921f28d9efaad044afc581f0af29deed138fff89c693abfcd162fa6a870a457775387bda8e5a63545b27e6aa5a52950b65c4d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef47025b0002000000";

    std::string strD6 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a456400752b7d00000000020000000273c08d732a4905aa658a797a4acdb58470c1bd1a09d872022326efcf5a06af91000000004847304402202d8242aa0142708beddf6ce7573ebfd113842c58aacf9e6bdaa65e465206e5f4022052fcf2a1d38f184df208bdf60b0ca8026f11b202c6cc592d0d43768573cca82b01ffffffff013d9eacc3ff502412ac4d0e6618921f28d9efaad044afc581f0af29deed138f020000008a4730440220643e6971aeeeb3d50f03769eef5074ce21da9ae90c32f73a51404c98766e9336022005cce6de8595f89d342f1297bdeeb78c001c1763997031a38bfdaa75425f29b20141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03801ca770000000001976a9141e78cdfa5c9bc60819b2f5ab97f2f45fc4a0af3a88ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a456400752b7d000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d000000054dd75341f054b52e0ce3500888e66d80f413a4c219311a59ef3ae821b716834ab7029216d24d70a484310c1ea0d188d2e8976d7b0d6ce3477f3213a89adb88c2f6a8dd8f1879fb0315b7b15b14e46121e4bb38b0895cbab204e678b1ba3685f7c48e521f1272245faf4689d99a390d970908d4d4ce9373043e465d81b8464875d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef47026b0002000000";

    std::string strD7 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a4564009ce4a60000000002000000029a9f7b2e850de2c3a9cea7bd2392ea8d4ed4eeb2eb6d79e1f0d7a3ab891053480000000049483045022100877de95d1b0a7f59e1825f9da0d7c3afd601e4a8426e34df7432d78a984b778002201632fe515d4a3d8c4a4fcc30e527856625548aff4424405ba1de9509338f9ae601fffffffff6a8dd8f1879fb0315b7b15b14e46121e4bb38b0895cbab204e678b1ba3685f7020000008b483045022100ddde123ca00d70b1b0d6c306a11b3530fe5bc6b317fe594369c7d2849e3c8f6c022002dad69a9fbe562fa91e89b10a4e923d4149d2ef4fcf6723d9938c893fbe93450141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03803bb16a000000001976a91494d27f3d6488c518fb07bb9e02cadf7330c6a27288ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a4564009ce4a6000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d000000054dd75341f054b52e0ce3500888e66d80f413a4c219311a59ef3ae821b716834ab7029216d24d70a484310c1ea0d188d2e8976d7b0d6ce3477f3213a89adb88c2f6a8dd8f1879fb0315b7b15b14e46121e4bb38b0895cbab204e678b1ba3685f7c48e521f1272245faf4689d99a390d970908d4d4ce9373043e465d81b8464875d654b5fff42a8b937bc6927ee3cef3ab23487df34a4dfd43f3e2d0208534ef4702ab0002000000";

    std::string strD8 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a456400a493d6000000000200000002e7430c9e105d49a2e026adc267e9a13ee15384492b56af8b90941f6117c175a700000000494830450221009484ccb73908adad1cf95add95edc1aa56f1c9892725c8fcb4b4c0aceb51c38a02200cbc0b92eefb47e7fa0aac8ff929bcbff894d01c4e86da5dbd80e0204a7357a501ffffffffc48e521f1272245faf4689d99a390d970908d4d4ce9373043e465d81b8464875020000008b48304502210081c529c12b81bc8bfc590ee8ebb9521c5180bbe909cb4a347d274da284475559022036c7decbdf88135233a74231baeba7176764d74a40b305b5145a8e2b745555ec0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03805abb64000000001976a9141c6d6d967c4bb5981a443a5645cd461a1390ca7f88ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a456400a493d6000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d00000005eca3e703ba56d7cac67bd78d404468af96629fdbfb884fdd06978cb38f7d717e3fdcd1c91b5b7b4d89c95ae1244ccf1d68fe721f759105d8cb52f868c08387d8e68a48f048f709a4e670e467834044b2d0019af8f10c4dad7c72b7de93e26ed844d79de7f057d03daab970ef92e86457aba6f98425d3f29575240b9656820f64c70b547df0dc8efdaa54dedd13cc3971c769dfc39db16b541f6de68457ae5fbf023d0002000000";

    std::string strD9 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a4564008d380c0100000002000000028cc80755314b97cd7a5ec7a15a683d35f5189aa3847f1bb898218bdc1962d4c10000000048473044022011f53dfbfdbd48683096b8d459ba2d1b27ef246cee267d6697318327a12d295b02207d9dbd28d1f1ef0326888a2f3ebccb149b9b14b67ce54a93f530baffdc71db4501ffffffff3fdcd1c91b5b7b4d89c95ae1244ccf1d68fe721f759105d8cb52f868c08387d8020000008a4730440220652d161341b46755885d6efdc85c0fe5f0a62dc1c1b2bc6dfe83cde9f614af2e02205b074357463bf18bcb784be7bb223ca232432c5483f3c4c543f8fc77553f9cb40141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038079c55e000000001976a914e4834bdbbbad51d6cfe9fea958897ff6cadbf9f388ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a4564008d380c010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d00000005eca3e703ba56d7cac67bd78d404468af96629fdbfb884fdd06978cb38f7d717e3fdcd1c91b5b7b4d89c95ae1244ccf1d68fe721f759105d8cb52f868c08387d8e68a48f048f709a4e670e467834044b2d0019af8f10c4dad7c72b7de93e26ed844d79de7f057d03daab970ef92e86457aba6f98425d3f29575240b9656820f64c70b547df0dc8efdaa54dedd13cc3971c769dfc39db16b541f6de68457ae5fbf025d0002000000";

    std::string strD10 = "4400f8ff19b93d9829f98763fc1797e367ff5e2a45640057d347010000000200000002df79dcc6479fc8b7002bd4413f81b1ca703e7d141c2104682889ef7627e4fc6e000000004847304402201724659fa79ea7f13532bfb8287cece5e5f3eb38b45b2ad2460844abe6adc6df02200c3cb1de1de8482946c58038c13fc23116f19feb5edffe7c43a3eaefbcff622601ffffffffe68a48f048f709a4e670e467834044b2d0019af8f10c4dad7c72b7de93e26ed8020000008b483045022100f00e0d749d9de4ff057c166ace454fd4befc7e8a6a8d8e2bc4810280bfe43d79022019797944a8e27cf270b833abf293d41e71d27a4d634ba219a455e5c64ac5fd960141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038098cf58000000001976a91401fa05e0a9e3744e77d14920b52ace164b87471f88ac0000000000000000166a14f8ff19b93d9829f98763fc1797e367ff5e2a45640057d347010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac000000000100003062cff41fe35d47b8ff10cb76ba8c6dbc41487edfa5764846a285f0b338096569ed2562fcb14c2a8e1d54905ad45db4fb789b9927c9f4f5f2e50cdb541ee6d9a07b2ea65dffff7f20000000000d00000005eca3e703ba56d7cac67bd78d404468af96629fdbfb884fdd06978cb38f7d717e2e1637fcd9631510f59349d69e94ee30a66bf0d65802fa2836a1b8796881d14ea0c4e49f04c79d3c9b2803269d810182eee041037169ec6d0caf74270b172958202b807730be16b3ec004241669feab3d632f16b89a2dfb515329eb79eab4c13c70b547df0dc8efdaa54dedd13cc3971c769dfc39db16b541f6de68457ae5fbf026d0002000000";

    CDataStream ss1(ParseHex(strD1), SER_DISK, CLIENT_VERSION);
    CDataStream ss2(ParseHex(strD2), SER_DISK, CLIENT_VERSION);
    CDataStream ss3(ParseHex(strD3), SER_DISK, CLIENT_VERSION);
    CDataStream ss4(ParseHex(strD4), SER_DISK, CLIENT_VERSION);
    CDataStream ss5(ParseHex(strD5), SER_DISK, CLIENT_VERSION);
    CDataStream ss6(ParseHex(strD6), SER_DISK, CLIENT_VERSION);
    CDataStream ss7(ParseHex(strD7), SER_DISK, CLIENT_VERSION);
    CDataStream ss8(ParseHex(strD8), SER_DISK, CLIENT_VERSION);
    CDataStream ss9(ParseHex(strD9), SER_DISK, CLIENT_VERSION);
    CDataStream ss10(ParseHex(strD10), SER_DISK, CLIENT_VERSION);

    // Unserialize the testing deposits

    SidechainDeposit d1;
    ss1 >> d1;
    SidechainDeposit d2;
    ss2 >> d2;
    SidechainDeposit d3;
    ss3 >> d3;
    SidechainDeposit d4;
    ss4 >> d4;
    SidechainDeposit d5;
    ss5 >> d5;
    SidechainDeposit d6;
    ss6 >> d6;
    SidechainDeposit d7;
    ss7 >> d7;
    SidechainDeposit d8;
    ss8 >> d8;
    SidechainDeposit d9;
    ss9 >> d9;
    SidechainDeposit d10;
    ss10 >> d10;

    std::vector<SidechainDeposit> vDeposit { d1, d2, d3, d4, d5, d6, d7, d8, d9, d10 };

    // Enable this for debugging
    //int i = 0;
    //for (const SidechainDeposit& d : vDeposit) {
    //    std::cout << "Deposit " << i << ":\n";
    //    std::cout << d.ToString() << std::endl;
    //    i++;
    //}

    return vDeposit;
}

std::vector<SidechainDeposit> Get25TestDeposits()
{
    // Serialization of 25 real sidechain deposits, in valid CTIP spend order.
    // Some of these spend a different outpoint of the same transaction.

    std::string strD1 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00e1f50500000000020000000001015878824bf819249bef045f27aa14329fe5e529331cfcd4af1deab0ce7fa7bc42010000001716001402ed93cac48ddd6a95c86ebd62868a9bb96aacdaffffffff03806ffa8d000000001976a91457daf03245822c86b69d212685de78768c7f723388ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00e1f505000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac02483045022100bd6909856142eec335defe33315a26d2e1aa288b6c39cbef834a50aafc06278502201bc12805e3334ef5a972296ce9be42e70ac99da4550bd18b42aae38e54ebe729012103ac53304b19f38204947806a3f0d23b05827d8c762e8bc22854a08ac44b75fc5d00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006c02591e556e7eb9ea160ada605d198dc5d42f4878512fcf2991d1842aa588610869355c9a9ce5fcdf185ad7b2e2308ec2d7751749483b939e8d5d308b89043faf0cba7896b0a259d9ddca47dc23a1ef68867840b23c8119627c75262a78c248a38a8dd02bcc6d5e781f3febf61b38649b49a0eacf7ba70f7f82ddbb78e01fd9baab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c025f0002000000";
    std::string strD2 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a3e111000000000200000002349d60fd86e8ca08959dba6390519a338cf955e26979cae9a76a4dae78905e510000000049483045022100ee5b1a4a981b90989be7ff00cb5c96444088f2ad3b1463c916b3331e1582a35702201c7cf1d5cde3cc4f6fc8edf4e65b55cbb51e7a42c32132e7f1f084f4d2944d5401ffffffff869355c9a9ce5fcdf185ad7b2e2308ec2d7751749483b939e8d5d308b89043fa020000008b483045022100c4aa0878468c117efd0dabc242bb422a904a0e961dc85c8619d323a819b19db0022006b2e3aa50f2158516092f9dbdaf44a1e4e87274323be6a3bdedb057a8cbad390141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380a07e88000000001976a9144ab62b3435a709773a7c5509e3961cd42832442c88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a3e111000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c0000000665fa6b04a8f891b47ed5cb22793e1f158713a2474431e4fc853385830355fb9203d800b2649e1ed2be8440edea9c6eac354ee4deb17b82e969b2a05fae7f445f3996137fe40c570794c8c4df96f9e792f5b21b7ceb9a01b77709fe6e941c0a5938a8dd02bcc6d5e781f3febf61b38649b49a0eacf7ba70f7f82ddbb78e01fd9baab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c026f0002000000";
    std::string strD3 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0046c3230000000002000000021fedb5a945b16e72b14cde03d14366465c2b050c0cfdc46a7227a977137593c20000000049483045022100ae530a71b41485b41a02f011b3184bcaf844f80b030a083b3f4f53d3a4aa576902207855163fcadd94a7b06a6aa44eeb22ed1f4252cc798e22f3564b9e09c127291401ffffffff03d800b2649e1ed2be8440edea9c6eac354ee4deb17b82e969b2a05fae7f445f020000008a4730440220184031b556361456e89226bcffae0d2aecd9a333746aa10d4abb4e506b15e74d02202409453fd074a07f3c9ace36c4fc394fa364360d99878d965bd37f8fabc2d52a0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380bf8882000000001976a914e5a81ccabe9a8cd46d6495a38f21d5f042b25bf988ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0046c323000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c0000000665fa6b04a8f891b47ed5cb22793e1f158713a2474431e4fc853385830355fb9203d800b2649e1ed2be8440edea9c6eac354ee4deb17b82e969b2a05fae7f445f3996137fe40c570794c8c4df96f9e792f5b21b7ceb9a01b77709fe6e941c0a5938a8dd02bcc6d5e781f3febf61b38649b49a0eacf7ba70f7f82ddbb78e01fd9baab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02af0002000000";
    std::string strD4 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00ca9a3b0000000002000000024a90bc263b8a15c664a1eb2cccfaa47f77b07cb328193a4e42e6f8c59d1dfafe0000000049483045022100b4337e152029b053be781f28c05887371057ace5553c99e20c2c2af32b42088c0220320ee2a3419efc91405cd648a98d53257c854e13373788dead13d4959fba8b3f01ffffffff3996137fe40c570794c8c4df96f9e792f5b21b7ceb9a01b77709fe6e941c0a59020000008a47304402204397b72f19c8336cc68bea259d30b301996332be4de19068e84c5fcde56c53270220343d0ce55839edc526c25dc6e37db6445d73e8b6fc4779e5ad81808e056d464e0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380de927c000000001976a9147096088ecfe82a48ce4bd80aa0018875a30005dd88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00ca9a3b000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c000000062a7c4da0716d1c4d279371c3a2bea7a79702eb5de2b81773d7e73de515d22cf43271ab78a3658198f1b96354add5f1df0c514f3cf5e9fd183a8d1f4ce63fa330ebcfabdd7f8e539597be6b438da52f7fed02c7d5995e53383b5fb353f422440b11de3503fc497601f22b51b3192f148bb37a039b75b834f5119f7c0442d27e61aab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02770002000000";
    std::string strD5 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb002f68590000000002000000021ad8b4f3c58cb51c5b986167ca7733f20537e9e66c728aba69ad788dd41486eb0000000048473044022064ee7476b514fe383ae82530216e7f13da412dff76b06d3ce9e22b0d516711710220444ed654f1c8bf8d0634e7b0e8dcc49eff33af9d001457535da5bb14d72cc7a101ffffffff3271ab78a3658198f1b96354add5f1df0c514f3cf5e9fd183a8d1f4ce63fa330020000008a473044022057fccb0d70b5753205ed843dd073a2d82645c841a198a888c7e6d4ccd99f504a02206ddf3269d71490e75be6a4a9ab0ebbafb64a1188657fc2bae5cb6f985d774a530141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380fd9c76000000001976a914984b2ea103f1ad6f81e323827322b0828b16321888ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb002f6859000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c000000062a7c4da0716d1c4d279371c3a2bea7a79702eb5de2b81773d7e73de515d22cf43271ab78a3658198f1b96354add5f1df0c514f3cf5e9fd183a8d1f4ce63fa330ebcfabdd7f8e539597be6b438da52f7fed02c7d5995e53383b5fb353f422440b11de3503fc497601f22b51b3192f148bb37a039b75b834f5119f7c0442d27e61aab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02b70002000000";
    std::string strD6 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00752b7d000000000200000002c5b91852a0da487d26e905a464ca59dfae2e6b3118b973b8cd79295209297bca00000000484730440220514429f9ae005155ce2c15424ce77f55d4f4ed5031bd67a933cd3f271117ee4f02205dffe8e1838e15394e5081944ad725f7de168b1c818bcba11680e02f3468778701ffffffffebcfabdd7f8e539597be6b438da52f7fed02c7d5995e53383b5fb353f422440b020000008b483045022100f5f99032d0dc94fe9ae81b81aff2bcbb780ff3492c6b1530fb1e3266085ab30f022013bca9cabbadb6c6f1e4c7432773f5d448c606563a8415eefe5cf5225d3364cd0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03801ca770000000001976a914aa691b15a459cd85f72e4a1daa41a2a8ce38d5e488ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00752b7d000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c000000062a7c4da0716d1c4d279371c3a2bea7a79702eb5de2b81773d7e73de515d22cf4ae95c0025ab36a1657a954b4932d1b3e89093043be92ed8e4a2dc9537738625a5744602baaaa61e09ec7198afb5f6e3f42086192047f0ccc894e45ddf5f0c63578471fc7d89d9f741b1bd914efc0a03a1f6933480098dd45042b42ded0536464aab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02d70002000000";
    std::string strD7 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb009ce4a60000000002000000022340831e823f95099a0249ce48d55f552666a49ddbcf46b91aeb76d72eed158000000000484730440220762c1d7ffeac9b4d9fa236f1feab02305fd26ff62a1ca5d1ee81d237f0024a0d0220202afe9312217254869e4f92b3342987beed012550f99e96baa5b56b5d18b4c501ffffffff5744602baaaa61e09ec7198afb5f6e3f42086192047f0ccc894e45ddf5f0c635020000008b483045022100d7159ebaadb83e050af0b2612df87aaa3cc416da378ce1fb1395d91b72dca75402201844bac95b2dab682e564a722e3b3930f326cba5aa009733e37b25f94783eeb00141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03803bb16a000000001976a9144ef324ccc0e5e88bddea677530472830ef019aa888ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb009ce4a6000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c000000062a7c4da0716d1c4d279371c3a2bea7a79702eb5de2b81773d7e73de515d22cf4ae95c0025ab36a1657a954b4932d1b3e89093043be92ed8e4a2dc9537738625a5744602baaaa61e09ec7198afb5f6e3f42086192047f0ccc894e45ddf5f0c63578471fc7d89d9f741b1bd914efc0a03a1f6933480098dd45042b42ded0536464aab0eeddbccd398dcd6a58f62809efbb49dd69e96d13f7c149b99edf71b7b724d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02570102000000";
    std::string strD8 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a493d6000000000200000002455770a7989d67c643926ecb45efff45d2a0940377e08e0e15d62da83a4351780000000048473044022029cf3d98888df58f2db613518e66aadedd96b2e789b9399d4f4da5e65273826302206451b764d92e25d3d6592c4081476a8b461e7c1fe99ff0846bc8d1dbe2bf838601ffffffff78471fc7d89d9f741b1bd914efc0a03a1f6933480098dd45042b42ded0536464020000008a473044022079e0e73af5277b162111dfc0d7e0ba40e96c11cdffca5bf6f891cb82c923bdd502206632482cacc6f85e754c8f14fa5bd3aa12c457f0294cb5db5092d17acd0651360141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03805abb64000000001976a91411f2af070fbc8617f47c24009dc8fd7dc48fe99188ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a493d6000000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428717439a2a7927e55a943e27b7888d96580d6ec24284845edb06967bfaa2db65668485845c13b6bffcc8dc9ee11275b9d7c1ae04ed0c3437f3b9dc60c0a463874f6f07d6388855e2f30d8f642b262e6c268f7f56d7e40db367a2b17586aa8006ec57ec114f112d09650839e158cc281f9c1cddc2bcb3b49329d728dc19705beaed45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c027b0002000000";
    std::string strD9 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb008d380c0100000002000000022a9ce2c3abad7eb3db6deec6f6c1be52e097bba3d02b66ec3739082fe5c9f8a20000000049483045022100938e959a45671b743b136093957e4c83fe0939dadd39cd99c51029264a9a1a2902207ede23574ebdd909b5109c22f81c9565f3e25b222f7d8c2a68b9bab2eb8c83cb01ffffffff717439a2a7927e55a943e27b7888d96580d6ec24284845edb06967bfaa2db656020000008a4730440220301c3f6e8c7b959b10a7f747baea6d73ab9c219f267cc27f6caf8bc92318e2d1022015733a714e212fe3a1ca4f744ab40fc6b08382b46752a9d9a4765b6be210357c0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038079c55e000000001976a9147dc9e4a7abf769f376d6981aa698ae4eb64177cb88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb008d380c010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428717439a2a7927e55a943e27b7888d96580d6ec24284845edb06967bfaa2db65668485845c13b6bffcc8dc9ee11275b9d7c1ae04ed0c3437f3b9dc60c0a463874f6f07d6388855e2f30d8f642b262e6c268f7f56d7e40db367a2b17586aa8006ec57ec114f112d09650839e158cc281f9c1cddc2bcb3b49329d728dc19705beaed45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02bb0002000000";
    std::string strD10 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0057d347010000000200000002d08e6289fb41f8cd2ebe6381d2bf0d15ad8e9c23c2e351035d3f0df8543c2d8b000000004948304502210084fb7da0bdfb05e09850656af0ee6019ce4c340b3faeee5ef5eb85d7b7998b85022070872e9bb9a1c402c5313e7a7e617d0591474c936452a041c1c81b190e0e149301ffffffff68485845c13b6bffcc8dc9ee11275b9d7c1ae04ed0c3437f3b9dc60c0a463874020000008b483045022100edd283b0bc2174d1fb9fe6046b9009f740ada93b4dda80d67defa5cad37c1e5d02207ce71b43e02cd6814ab46d0e3f88431dbdf4f5d85b77f398a05b8e7c0000a6d20141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038098cf58000000001976a9146e2331efa891d58da3adc592af49a90319ecd33688ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0057d347010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428e5347f3f4720457b6a6b85ecc748ebf978888d183a59b86ccb5f093a23209e968580f34ad642194f952a65967c931e3f2f1c30e5c014d1867fc8a0d92546e949adb00a5744a80a41b1e859aa54539727b33490e0fd43cf7a3f803e2e5ca8e6f0c57ec114f112d09650839e158cc281f9c1cddc2bcb3b49329d728dc19705beaed45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02db0002000000";
    std::string strD11 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00026489010000000200000002681fa3c8d8b460008ac70041a7306cfff140059a634cd566f53aa5e7b332bc4d00000000484730440220402fe4ff97fa349b5d5ff0a7cbea74d4859bb276f41683f81ed0920f93849e920220697814e3ed4f542c42340a8db111415b847c3a08152376ecc93c6e32570d693601ffffffff8580f34ad642194f952a65967c931e3f2f1c30e5c014d1867fc8a0d92546e949020000008a4730440220446369f8ca4dd3d91e3c6d0fea2869a6126e56d514fc09bde1e47e9e20540c6c02202e4bc241e6c2ce1b2bb4f644d6d558cc93db5d64b162b96ec929ada532c2cd960141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380b7d952000000001976a914cab56e0676259e311a42e7719c82b11f889d1af388ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00026489010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428e5347f3f4720457b6a6b85ecc748ebf978888d183a59b86ccb5f093a23209e968580f34ad642194f952a65967c931e3f2f1c30e5c014d1867fc8a0d92546e949adb00a5744a80a41b1e859aa54539727b33490e0fd43cf7a3f803e2e5ca8e6f0c57ec114f112d09650839e158cc281f9c1cddc2bcb3b49329d728dc19705beaed45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c025b0102000000";
    std::string strD12 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb008eead0010000000200000002b1a62cfc67d6d56e7f5e1c1fd8e907839ca64ee34bb626783b85d792a5bedce40000000049483045022100e5d6c39cc65e758c3fc8eb92bbb62d70e2ebf4ab0c57cd31d2395d22410701e602202ecdc2ac6933e75c83d5d133e6b6e53d6fdfd9e5dc2f4dcb4d4c9480b77b95e401ffffffffadb00a5744a80a41b1e859aa54539727b33490e0fd43cf7a3f803e2e5ca8e6f0020000008b48304502210092d6def48118a28bb5657ced222591769cc9f046e70c1d911ddc6d341135803d0220647c05d73a633a1567ff86b9690fb07c3f2affbe9544409aab6e3e1ce2b56ce70141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380d6e34c000000001976a914a2cc8d14e8473c92a6aba64110d02ab3fa2c47d788ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb008eead0010000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428b48fda9cd31d47c90ba3cf5b92fb2c2f8071d81cc7299a2d9961d8a0c030149146e13de87ff98b6094002241ff7953fcc0d97c3a398f32c5e9323bbfee915801a11c03f6abcac518e6b6e5595f243a376c4bd2ef113380e24c96ed2cbd2fe4dbcecddf52dc6cb3cf835588d3fb056d76db7671b27292dd41097958c33e0b2885d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02eb0002000000";
    std::string strD13 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00fb661e020000000200000002099365a2bb91fc106ee2fcec7a6cc5b4159b569aacb5d39114f0317ec73b739c000000004847304402203b7d3f4e85b9c491c63b65b8d1b734e1c1cbd8278ade190b334ed60cb94867e502206b316f6d08ff2ce03d05d0e9a8cd10aa7fd252e006a6c25d62d56c49927487f101ffffffff46e13de87ff98b6094002241ff7953fcc0d97c3a398f32c5e9323bbfee915801020000008a47304402200f87581b0a903f1f6f4191ad82d438391c0ef01956821c8ef8ea8e969cfb1eaf02204d388e4d89c08ee2488f524e421313ba6b2fb174cee2b1a08466352225cc062e0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380f5ed46000000001976a91457f53279f96b33310a43ca896ea64266426e12fa88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00fb661e020000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428b48fda9cd31d47c90ba3cf5b92fb2c2f8071d81cc7299a2d9961d8a0c030149146e13de87ff98b6094002241ff7953fcc0d97c3a398f32c5e9323bbfee915801a11c03f6abcac518e6b6e5595f243a376c4bd2ef113380e24c96ed2cbd2fe4dbcecddf52dc6cb3cf835588d3fb056d76db7671b27292dd41097958c33e0b2885d45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c026b0102000000";
    std::string strD14 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0049d9710200000002000000026fc4084195ca9b1397f2655b32285aeb43692677d64f71152f0f50e8d41581b10000000048473044022039cf96e3ac64ea94a2823248870abf2ea93be701419f8179ed454776fc67489d0220375296a9b4bdeb3836bc7ea79f080193ce29a6c56b11597ea2b5bdedf295035501ffffffffa11c03f6abcac518e6b6e5595f243a376c4bd2ef113380e24c96ed2cbd2fe4db020000008b483045022100ab0c324ce68e8998aa21fdbc9903545755935bc340d27f16310a64bb0055dcd402206361b9addd6d23d4790f398847a34b059dd06e18c4c63938e5c98e20469d337c0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038014f840000000001976a914813278f15f1570abae6f0023970e86abb7a84ffa88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0049d971020000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428b48fda9cd31d47c90ba3cf5b92fb2c2f8071d81cc7299a2d9961d8a0c03014916e382d7ca1b4c8a726164d4b7c801bb16effbb4482a4371ed2b2a1920f9ee6438109917d9f1c77e5b1f874f12195659639184b8d7e54d6a8d6ae5a1736487ba3c0f7dcfec0b9ecf48353f60db6f44f556abae59caf3b0aef5f6ffc4a7848d5add45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02ab0102000000";
    std::string strD15 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb007841cb020000000200000002a23984ffe4eed914ba7013bcc47fbf3629a548e22140a6692bc4bd0ad5b2892b0000000048473044022061a18cf6fecd241a6181ddf949005551210a4e42a9c03ad4e384f30b54f0ba9e022049388c3e4981095ec94d930ab585925c6620e49080eb240d6a31ef8358801a3e01ffffffff8109917d9f1c77e5b1f874f12195659639184b8d7e54d6a8d6ae5a1736487ba3020000008a473044022065472c041607887c250cddc8b71144cd4bd4e96d97776a445bcde20adbf10a3502201cefbccd5a294375273dd5cf5682014530c859288c0a0ca6ce1546fdb080e6db0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038033023b000000001976a914732d312e8a95af4eeddeafae5ca8dd9ec9e909c288ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb007841cb020000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006b1eee1855ee8aefb2a358508cb6ec953a8598c5afef30652e4b53317a2810428b48fda9cd31d47c90ba3cf5b92fb2c2f8071d81cc7299a2d9961d8a0c03014916e382d7ca1b4c8a726164d4b7c801bb16effbb4482a4371ed2b2a1920f9ee6438109917d9f1c77e5b1f874f12195659639184b8d7e54d6a8d6ae5a1736487ba3c0f7dcfec0b9ecf48353f60db6f44f556abae59caf3b0aef5f6ffc4a7848d5add45f4339fae28e1b16485d6eeb95bee2e5c9e6792836616f26f2df9d9de0d67c02ab0202000000";
    std::string strD16 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00889f2a030000000200000002667f5afcfe6cef90f7bdadec955b0e7ab56a2ee3854cba2fed00b877b64bc994000000004847304402203ba86923c289ac477302b582567dfe5459ff4189dd72843f3f7998473bef24510220717af7441810ef176fa2b3e3225068822d02284d15bd408dd36360f4018be7b901ffffffffc0f7dcfec0b9ecf48353f60db6f44f556abae59caf3b0aef5f6ffc4a7848d5ad020000008b483045022100b2908477a35012cc936972110447f614575c71c23be15c3178118dd9d07b263c022040830b04bd4df5b224352f8a0d928973c6a8479fcabf5094ccf79a5937365f170141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380520c35000000001976a9148f0c569d0015eeab0258bb16b5b9984c9cb4b92588ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00889f2a030000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61dc187c094b1886e6d17b7d47601177e9d41f3e606c619bb792e56822fa7e2740950b0b9729a6071ee2b8d90f8a597e8d9c0d0f1be529cc774a00d2bceb8da455d51d2822f161ee4e04be986709ebaf5dcd80131b0b4e678475813ff9f93d2f9b608fef9bd5f190cbabde4b4afc288e742b72d05b664a0cc520a6a02997379eca0f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd152027d0002000000";
    std::string strD17 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0079f38f0300000002000000028d2dd9c596d5535108e3803780004e080d260524375b76d1a900b96d6256deb6000000004948304502210084607a5d58dac0058d372295d380f8de4a7e9fce36289e6bcda93655ab540b540220235260c2d980445a0a9999dba892b09aa185e77f307b9bbac6d295a3a7884c7601ffffffffc187c094b1886e6d17b7d47601177e9d41f3e606c619bb792e56822fa7e27409020000008a473044022030d9158a189a786a063587fb9892520bb94f6a6fe207e93d3ddb016e623a6b1902204291ad82c57dbdab54c7c6d9dbc0fb888f1ae63bf6ec4d78b4b03b7b3f5437850141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff038071162f000000001976a9141157b7086e0ba106a7041a5adfa326e8c3637fc688ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0079f38f030000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61dc187c094b1886e6d17b7d47601177e9d41f3e606c619bb792e56822fa7e2740950b0b9729a6071ee2b8d90f8a597e8d9c0d0f1be529cc774a00d2bceb8da455d51d2822f161ee4e04be986709ebaf5dcd80131b0b4e678475813ff9f93d2f9b608fef9bd5f190cbabde4b4afc288e742b72d05b664a0cc520a6a02997379eca0f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd15202bd0002000000";
    std::string strD18 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb004b3dfb030000000200000002f7af594e49145bbdec2b7611fb0505460b041225f6fa7e3874bc3e74e6f0e64e000000004948304502210081bc6719222833e439b81fa31eda5aa4bd96bf43a878b028ad9abb3ad6824c00022011af0c24b2a881b9d67776163917b9b1d6cbe84cb488d1d45c355816b1b6e26401ffffffff50b0b9729a6071ee2b8d90f8a597e8d9c0d0f1be529cc774a00d2bceb8da455d020000008a4730440220167484c969030e5b70b5c6d67c79d8fdedba61e62fa94b078cf41a1754fea02a022023408f21a8af8edd6eceb83f09cb22df63f36e3b60d3dd4045eb64f336258fde0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380902029000000001976a9140c259b89df6138c3797f50d1e2a0d831748edc3788ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb004b3dfb030000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61daacac6bcc2b8b6162629c4cc1c987df1a2cd67cbbd73a3747457c0e85dc03b85d77c65a1011d73ff2310b12e4515a6672549e1579de4da44a8b7d0ebfc79e731e8b7e992ed4414f6000d9ecca32202ab44c73f0b599fab43d0dd59a5373c844e08fef9bd5f190cbabde4b4afc288e742b72d05b664a0cc520a6a02997379eca0f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd15202dd0002000000";
    std::string strD19 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00fe7c6c0400000002000000028d1864ea69dfb26524561b048e43b19adb95b659d6197fad69df5698bff3f40900000000484730440220629b9f6e3218c441861f9ae7cef66a990044a99c7b41fac8351a3e006ac2b1f0022069dfa28e11d426394e3006b1b1ee2640da8b4c613fb1acc7fcdf3b0577adcf7501ffffffffd77c65a1011d73ff2310b12e4515a6672549e1579de4da44a8b7d0ebfc79e731020000008b483045022100b3a1666c17710235a889e059a1dc899e1c0bb13a46c355c40a9c20692dc52720022052f039d726282108f965b8ed59454e6f123cfd4ca43924aa9ee88147d7288da80141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380af2a23000000001976a9140500a3d62681b3a7a5d4d188284980a553cd37ef88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00fe7c6c040000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61daacac6bcc2b8b6162629c4cc1c987df1a2cd67cbbd73a3747457c0e85dc03b85d77c65a1011d73ff2310b12e4515a6672549e1579de4da44a8b7d0ebfc79e731e8b7e992ed4414f6000d9ecca32202ab44c73f0b599fab43d0dd59a5373c844e08fef9bd5f190cbabde4b4afc288e742b72d05b664a0cc520a6a02997379eca0f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd152025d0102000000";
    std::string strD20 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0092b2e3040000000200000002288841188746ce9010d9327b1bcbd460fb432f06676f8d0f07745f12d386046a000000004847304402200a5179d7f18bfc05a865b087a56eb010faf4596e819ac9524dfbe27507beb980022073847cbefe1ea617a84311602d8bb8b3258701e57b05000b3a20677457cdc47201ffffffffe8b7e992ed4414f6000d9ecca32202ab44c73f0b599fab43d0dd59a5373c844e020000008a47304402204853b7a33c9226d8d6a994d5537d5cc6cf99d55aaa93e9098a4d9834353c6d500220771b67e0d61e3bc931a938df9f43ad8de18f5fa7d1d3c5c67a3267a3064ab1c40141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380ce341d000000001976a914be1532bfe94190b4f31998e9c84cb08f3a59302d88ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0092b2e3040000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d757902e6db85b24670ea6ea31bd07006c6ca5aeeeaad8140810db7efa450b094106635567d8238770970529cefbf7a8bd3a7a003fa4a039f204dd05ba8574721a8e3d5b32b6011e058a78520b10cc58d1cbd280b94e5e9b532127f4269393e330d8c3627356cb25958745230cd925158139e94134d0c6f5fc808e0157bb75239f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd15202ed0002000000";
    std::string strD21 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0007de60050000000200000002dffb000aa2cfdf63c699fe57e5816e87b801f278c958d1b2c94ccb6441ac479c0000000049483045022100de3d17897aa47043951df83d34ad3bf882575648395b323640a73c3da1ff2d43022067d90267168473748ee223949d21764038c128a934fb4d057d9381861310f78801ffffffff106635567d8238770970529cefbf7a8bd3a7a003fa4a039f204dd05ba8574721020000008b483045022100ccdb439f3261d4bbf89de8388555c1ee74f9984c0409e01ba6afdc94b6adc0390220726a3e753a1ac4860191c4bfe460bc7f47ea8fc386665c4b8c8eaed42afc9feb0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380ed3e17000000001976a914ae916f2d99a85f127a4b523537d9cc0ef7d539a388ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0007de60050000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d757902e6db85b24670ea6ea31bd07006c6ca5aeeeaad8140810db7efa450b094106635567d8238770970529cefbf7a8bd3a7a003fa4a039f204dd05ba8574721a8e3d5b32b6011e058a78520b10cc58d1cbd280b94e5e9b532127f4269393e330d8c3627356cb25958745230cd925158139e94134d0c6f5fc808e0157bb75239f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd152026d0102000000";
    std::string strD22 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb005dffe3050000000200000002128788a52bc996e02c07ba9add95e91bd6ef2e1fa15e251887861d0ead13e8d80000000049483045022100de440d428fd0e5a763c7afc72288eeeb1bd0427e7628efcb08b4d03386216ed10220671f67e1a87cfa29d42790c06b6ed1ec0bf902408143bfaaf6e66325cbd5136101ffffffffa8e3d5b32b6011e058a78520b10cc58d1cbd280b94e5e9b532127f4269393e33020000008b48304502210087d2968cfcfa7500887fd8c7c08707f839d37269c9f2069a1c4b6d5797c775e402207897cb4850f30e8bebe4553596e1165391b30bf0a03db7c0fa0a45e959e1af5a0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03800c4911000000001976a9147b83ee98336e82d973e1d74f78f23f38f3230da488ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb005dffe3050000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d757902e6db85b24670ea6ea31bd07006c6ca5aeeeaad8140810db7efa450b0940c4075b13535804afa552bad75f9c2bbc141cbcf9789ca050e57ca101187e37b9d9e25e9b1a92efee057f4f0f6fa04a1016533ed4aa83cc5fc856ff6e5cab3eaa20238cba66bff55c9b9aef2729c0ffdb499f9d54fd53b7f6fa62c2e757fbe45f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd15202ad0102000000";
    std::string strD23 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb0094166d0600000002000000020bac149c53288ad14344fa20993884af3f4e0dce485bc9589e862fb91061ea850000000049483045022100a6253027b1c6258c468fdcf84bf68d29307526aebbfa67156110ab3843a41277022078730dacbd3670159162f554adc84420acb5c4b7514d62c663452b9627cd430c01ffffffff9d9e25e9b1a92efee057f4f0f6fa04a1016533ed4aa83cc5fc856ff6e5cab3ea020000008b483045022100c17f84a1155dd76380b09cddd51e5666a926902d04f5abdd8e9f1ea61b37e5b602203dbad2d34d601863d4833a77d0863d4daeef8093a5e49298042a110f8e0016ac0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03802b530b000000001976a9146d20502004ba8475d55fa4d479b1df81dbbe00f488ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb0094166d060000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000006a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d757902e6db85b24670ea6ea31bd07006c6ca5aeeeaad8140810db7efa450b0940c4075b13535804afa552bad75f9c2bbc141cbcf9789ca050e57ca101187e37b9d9e25e9b1a92efee057f4f0f6fa04a1016533ed4aa83cc5fc856ff6e5cab3eaa20238cba66bff55c9b9aef2729c0ffdb499f9d54fd53b7f6fa62c2e757fbe45f14421c7c73d8b3d75b3031e48cb4224ff76e330fa1ab42da1603e63666cd15202ad0202000000";
    std::string strD24 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00ac23fc06000000020000000287304862103a0dcaf28d27533b75a827b6b871cd0bc72a38ad128b7c3300b8f00000000048473044022019b9d6ae9fce39d30d3a0029894f48c89bac01bceaa7669d304b5cce39a0d9e60220425d7ab865608064081eb285c711349d24f484e958d060a0744a12472151014701ffffffffa20238cba66bff55c9b9aef2729c0ffdb499f9d54fd53b7f6fa62c2e757fbe45020000008a47304402203e50ffac532daf933e3aceb5eb6b4df2c0edf295430fe3bade83489aa15b6022022058bbf3f071c84b401cd08031c8e7c4581d2f58ebd0defc8a1f21aa06129ee37c0141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff03804a5d05000000001976a914d53101bbd5a6e243111bd76e0ca8241f600c17f788ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00ac23fc060000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000005a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d86b7a2b7d211c3206210383b0c79d5c07c364eb662d4e823d47569b398542691890b24082a7d08387beb612e35e56aac774528c548e97937193b75c6477ebee4924424b6752e71235095de49fabcf15a6b667e5b99f34c5c2570c7c8cd177b053802bbbf37268a1d84f29e42e83bcc9025e8bf970f1e7abe01ab1aea292af03b02f50002000000";
    std::string strD25 = "4400f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a5269107000000020000000200687709b6613d04d04b8445a18564596eb8b5f9e235362a9e2313e2d25a73dc0000000049483045022100d1d37a3b8be6c1b890a9150d69a21e05ffaa39868f0f1862c73a1c78f003c4d402203864bc857aa7ebea7ba843f31f37a36fa34ce0c1adb499eb872a034b2522db8801ffffffff890b24082a7d08387beb612e35e56aac774528c548e97937193b75c6477ebee4020000008b483045022100ef68b2e5b29d8bffaed7bbb6404a00ee13cb79a583075fea476c6c0f054d6da2022062c94c843c5cd69d44f0f6edc422b545e96de1cd83c6743bce77ea1984272da20141043a6a472d711c6b4751af0cf82f397909469f943788f89bb7dfb1292d2a40e662ef2c32e6798315cc5fc21432e1db5513de3ddb3bda295199b065959cd76cf01cffffffff0380626a94000000001976a914fd9c53c52524f1ad037320fda2cfea50f346f7f888ac0000000000000000166a14f9911de124c78c6cf5b77c78656f0e1174f4cdcb00a52691070000001976a91458c63096724814c3dcdf088b9bb0dc48e6e1a89c88ac00000000010000307568217081e4462897e203ff21340765bc75ee50208d0c7895c4ef6c81b504f6f9de9b46e2165b7fa8d213f8aa1b1f464c0eece01f99c1ca942e4fed045345c13355a65dffff7f20030000001c00000005a578d6121605c3976411b0cc13948c9494c8f00b02fdb0ace7d59f8e5d56a61d86b7a2b7d211c3206210383b0c79d5c07c364eb662d4e823d47569b398542691890b24082a7d08387beb612e35e56aac774528c548e97937193b75c6477ebee4924424b6752e71235095de49fabcf15a6b667e5b99f34c5c2570c7c8cd177b053802bbbf37268a1d84f29e42e83bcc9025e8bf970f1e7abe01ab1aea292af03b02750102000000";

    CDataStream ss1(ParseHex(strD1), SER_DISK, CLIENT_VERSION);
    CDataStream ss2(ParseHex(strD2), SER_DISK, CLIENT_VERSION);
    CDataStream ss3(ParseHex(strD3), SER_DISK, CLIENT_VERSION);
    CDataStream ss4(ParseHex(strD4), SER_DISK, CLIENT_VERSION);
    CDataStream ss5(ParseHex(strD5), SER_DISK, CLIENT_VERSION);
    CDataStream ss6(ParseHex(strD6), SER_DISK, CLIENT_VERSION);
    CDataStream ss7(ParseHex(strD7), SER_DISK, CLIENT_VERSION);
    CDataStream ss8(ParseHex(strD8), SER_DISK, CLIENT_VERSION);
    CDataStream ss9(ParseHex(strD9), SER_DISK, CLIENT_VERSION);
    CDataStream ss10(ParseHex(strD10), SER_DISK, CLIENT_VERSION);
    CDataStream ss11(ParseHex(strD11), SER_DISK, CLIENT_VERSION);
    CDataStream ss12(ParseHex(strD12), SER_DISK, CLIENT_VERSION);
    CDataStream ss13(ParseHex(strD13), SER_DISK, CLIENT_VERSION);
    CDataStream ss14(ParseHex(strD14), SER_DISK, CLIENT_VERSION);
    CDataStream ss15(ParseHex(strD15), SER_DISK, CLIENT_VERSION);
    CDataStream ss16(ParseHex(strD16), SER_DISK, CLIENT_VERSION);
    CDataStream ss17(ParseHex(strD17), SER_DISK, CLIENT_VERSION);
    CDataStream ss18(ParseHex(strD18), SER_DISK, CLIENT_VERSION);
    CDataStream ss19(ParseHex(strD19), SER_DISK, CLIENT_VERSION);
    CDataStream ss20(ParseHex(strD20), SER_DISK, CLIENT_VERSION);
    CDataStream ss21(ParseHex(strD21), SER_DISK, CLIENT_VERSION);
    CDataStream ss22(ParseHex(strD22), SER_DISK, CLIENT_VERSION);
    CDataStream ss23(ParseHex(strD23), SER_DISK, CLIENT_VERSION);
    CDataStream ss24(ParseHex(strD24), SER_DISK, CLIENT_VERSION);
    CDataStream ss25(ParseHex(strD25), SER_DISK, CLIENT_VERSION);

    // Unserialize the testing deposits

    SidechainDeposit d1;
    ss1 >> d1;
    SidechainDeposit d2;
    ss2 >> d2;
    SidechainDeposit d3;
    ss3 >> d3;
    SidechainDeposit d4;
    ss4 >> d4;
    SidechainDeposit d5;
    ss5 >> d5;
    SidechainDeposit d6;
    ss6 >> d6;
    SidechainDeposit d7;
    ss7 >> d7;
    SidechainDeposit d8;
    ss8 >> d8;
    SidechainDeposit d9;
    ss9 >> d9;
    SidechainDeposit d10;
    ss10 >> d10;
    SidechainDeposit d11;
    ss11 >> d11;
    SidechainDeposit d12;
    ss12 >> d12;
    SidechainDeposit d13;
    ss13 >> d13;
    SidechainDeposit d14;
    ss14 >> d14;
    SidechainDeposit d15;
    ss15 >> d15;
    SidechainDeposit d16;
    ss16 >> d16;
    SidechainDeposit d17;
    ss17 >> d17;
    SidechainDeposit d18;
    ss18 >> d18;
    SidechainDeposit d19;
    ss19 >> d19;
    SidechainDeposit d20;
    ss20 >> d20;
    SidechainDeposit d21;
    ss21 >> d21;
    SidechainDeposit d22;
    ss22 >> d22;
    SidechainDeposit d23;
    ss23 >> d23;
    SidechainDeposit d24;
    ss24 >> d24;
    SidechainDeposit d25;
    ss25 >> d25;

    std::vector<SidechainDeposit> vDeposit { d1, d2, d3, d4, d5, d6, d7, d8,
        d9, d10, d11, d12, d13, d14, d15, d16, d17, d18, d19, d20, d21, d22,
        d23, d24, d25 };

    // Enable this for debugging
    //int i = 0;
    //for (const SidechainDeposit& d : vDeposit) {
    //    std::cout << "Deposit " << i << ":\n";
    //    std::cout << d.ToString() << std::endl;
    //    i++;
    //}

    return vDeposit;
}

BOOST_AUTO_TEST_CASE(sidechain_deposit_sort_10_deposits)
{
    // This test is testing 10 deposits which all spend different transactions

    // Get 10 deposits in valid CTIP spend order
    std::vector<SidechainDeposit> vD = Get10TestDeposits();

    // Test sorting the deposits when they are already in valid order
    std::vector<SidechainDeposit> vDepositSorted;
    BOOST_CHECK(SortDeposits(vD, vDepositSorted));
    BOOST_CHECK(vD == vDepositSorted);

    vDepositSorted.clear();

    // Test sorting from reverse order
    std::vector<SidechainDeposit> vReverse = vD;
    std::reverse(vReverse.begin(), vReverse.end());
    BOOST_CHECK(SortDeposits(vReverse, vDepositSorted));
    BOOST_CHECK(vD == vDepositSorted);

    vDepositSorted.clear();

    // Test sorting a random order
    std::vector<SidechainDeposit> vRandom {vD[1], vD[0], vD[3], vD[2], vD[4],
        vD[5], vD[7], vD[6], vD[9], vD[8]};

    BOOST_CHECK(vRandom != vD);
    BOOST_CHECK(SortDeposits(vRandom, vDepositSorted));
    BOOST_CHECK(vDepositSorted == vD);
}

BOOST_AUTO_TEST_CASE(sidechain_deposit_sort_25_deposits)
{
    // This test is testing 25 deposits some of which spend different outputs
    // of the same transaction

    // Get 25 deposits in valid CTIP spend order
    std::vector<SidechainDeposit> vD = Get25TestDeposits();

    // Test sorting the deposits when they are already in valid order
    std::vector<SidechainDeposit> vDepositSorted;
    BOOST_CHECK(SortDeposits(vD, vDepositSorted));
    BOOST_CHECK(vD == vDepositSorted);

    vDepositSorted.clear();

    // Test sorting from reverse order
    std::vector<SidechainDeposit> vReverse = vD;
    std::reverse(vReverse.begin(), vReverse.end());
    BOOST_CHECK(SortDeposits(vReverse, vDepositSorted));
    BOOST_CHECK(vD == vDepositSorted);

    vDepositSorted.clear();

    // Test sorting random order
    std::vector<SidechainDeposit> vRandom {vD[1], vD[0], vD[21], vD[16], vD[4],
        vD[24], vD[15], vD[7], vD[9], vD[8], vD[13], vD[11], vD[12], vD[10],
        vD[14], vD[6], vD[3], vD[17], vD[20], vD[19], vD[18], vD[2],
        vD[22], vD[23], vD[5]};

    BOOST_CHECK(vRandom != vD);
    BOOST_CHECK(SortDeposits(vRandom, vDepositSorted));
    BOOST_CHECK(vDepositSorted == vD);
}

BOOST_AUTO_TEST_SUITE_END()
